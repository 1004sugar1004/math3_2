# 🎲 나눗셈 탐험 보드게임

나눗셈을 재미있게 배울 수 있는 교육용 보드게임 웹 애플리케이션입니다.

## 📋 프로젝트 개요

초등학생들이 나눗셈의 나머지 개념을 자연스럽게 학습할 수 있도록 설계된 턴제 보드게임입니다. 2-4명의 플레이어가 주사위를 굴려 나눗셈 문제를 완성하고, 나머지 값만큼 이동하여 목적지에 먼저 도착하는 게임입니다.

## ✨ 주요 기능

### 현재 구현된 기능
- ✅ **플레이어 선택**: 1명(혼자) 또는 2명 플레이 가능
- ✅ **순서 결정**: 컴퓨터가 자동으로 가위바위보와 주사위를 굴려 순서 결정 (애니메이션 효과)
- ✅ **보드게임 시스템**: 27칸의 구불구불한 경로 보드판
- ✅ **주사위 시스템**: 애니메이션과 함께하는 주사위 굴리기
- ✅ **나눗셈 계산 학습**: 
  - 빈칸에 주사위 값 자동 입력
  - **학생이 직접 나머지를 계산하여 입력** (직접 입력 방식)
  - Enter 키 지원으로 빠른 답변
  - 정답/오답 즉시 피드백 (시각적 + 청각적)
  - 틀린 경우 다시 입력 가능 (힌트 제공)
  - 정답 시 나머지만큼 이동
  - 선택적 보기 버튼 (💡 힌트)
- ✅ **특수 칸**: "뒤로 2칸 이동" 특수 효과 (3곳)
- ✅ **턴 관리**: 순차적 턴제 시스템
- ✅ **승리 판정**: 먼저 도착한 플레이어 승리
- ✅ **시각적 피드백**: 
  - 플레이어별 색상 구분
  - 현재 턴 강조 표시
  - 실시간 위치 업데이트
  - 경로 화살표 표시
  - 정답/오답 애니메이션 효과 (shake, color change)
  - 단계별 과정 시각화 (주사위→빈칸→계산→입력)
- ✅ **사운드 효과** (Web Audio API):
  - 주사위 굴리기 소리
  - 정답 멜로디 (상승 음계)
  - 오답 소리 (하강 음)
  - 이동 효과음 (뽁뽁뽁)
  - 승리 팡파레
  - 버튼 클릭 소리
  - 소리 ON/OFF 토글 버튼
- ✅ **안정성 개선** (2025-01-13):
  - 이벤트 리스너 중복 방지
  - 메모리 누수 방지 (oscillator cleanup)
  - 중복 제출 방지
  - 사이트 멈춤 현상 해결

## 🎮 게임 규칙 (초등학교 3학년 수학 교과서 기준)

### 📋 정확한 게임 순서

1. **① 플레이어 수 선택**
   - **혼자 플레이**: 도착 지점까지 나눗셈 연습
   - **2명 플레이**: 컴퓨터가 자동으로 가위바위보와 주사위를 굴려 순서 결정
   - 주사위 값이 높은 플레이어부터 진행

2. **② 주사위 1개를 던집니다**
   - 자신의 차례에 주사위를 굴립니다 (1-6)

3. **③ 자신의 말이 있는 곳의 □ 안에 주사위 눈의 수를 써넣어 나눗셈을 만듭니다**
   - 현재 자신의 말이 있는 칸의 나눗셈 문제 빈칸(□)에 주사위 값을 입력
   - 예: 칸의 문제가 "5_÷3"이고 주사위가 2가 나오면 → "52÷3"
   - 주사위 값이 자동으로 빈칸에 채워집니다

4. **④ 나눗셈을 계산하고, 나머지만큼 앞으로 이동합니다**
   - 완성된 나눗셈의 나머지를 계산합니다
   - 6개 보기 중에서 정답을 선택합니다
   - **정답 선택 시**: 나머지만큼 앞으로 이동
   - **오답 선택 시**: 다시 계산하여 선택 (틀린 답은 비활성화)
   - **나머지가 0인 경우**: 말을 이동하지 않고 □ 안의 수를 지운 후 다음 턴에 다시 시도

5. **⑤ 목표 달성**
   - **2명 플레이**: 도착 칸(26번)에 먼저 도달한 플레이어 승리
   - **혼자 플레이**: 도착 지점까지 나눗셈 학습 완료

### 🎯 특수 칸
- **"뒤로 2칸 이동"** (8번, 11번, 22번 칸)
  - 해당 칸에서 차례가 시작되면 뒤로 2칸 이동

## 🎯 보드 구성 (27칸 - 구불구불한 경로)

보드는 5x6 그리드에 배치된 27개의 칸으로 구성되며, 화살표를 따라 구불구불한 길을 따라갑니다.

| 칸 | 내용 | 설명 |
|---|------|------|
| 0 | 시작 | 게임 시작 지점 |
| 1 | 5_÷3 | 십의 자리에 주사위 값 입력 |
| 2 | 7_÷5 | 십의 자리에 주사위 값 입력 |
| 3 | 3_÷2 | 십의 자리에 주사위 값 입력 |
| 4 | 3÷4_ | 나누는 수의 일의 자리에 입력 |
| 5 | _4÷8 | 백의 자리에 주사위 값 입력 |
| 6 | 3_÷5 | 십의 자리에 주사위 값 입력 |
| 7 | 1÷2_ | 나누는 수의 일의 자리에 입력 |
| 8 | 뒤로 2칸 이동 | 특수 칸 |
| 9 | 5_÷6 | 십의 자리에 주사위 값 입력 |
| 10 | 4_÷4 | 십의 자리에 주사위 값 입력 |
| 11 | 뒤로 2칸 이동 | 특수 칸 |
| 12 | 45_÷5 | 백의 자리에 주사위 값 입력 |
| 13 | 23_÷7 | 백의 자리에 주사위 값 입력 |
| 14 | 20_÷3 | 백의 자리에 주사위 값 입력 |
| 15 | 92_÷4 | 백의 자리에 주사위 값 입력 |
| 16 | 8_÷2 | 십의 자리에 주사위 값 입력 |
| 17 | 81_÷4 | 백의 자리에 주사위 값 입력 |
| 18 | 6÷4_ | 나누는 수의 일의 자리에 입력 |
| 19 | _4÷4 | 백의 자리에 주사위 값 입력 |
| 20 | 34_÷3 | 백의 자리에 주사위 값 입력 |
| 21 | 13_÷9 | 백의 자리에 주사위 값 입력 |
| 22 | 뒤로 2칸 이동 | 특수 칸 |
| 23 | 1_÷3 | 십의 자리에 주사위 값 입력 |
| 24 | 1_÷4 | 십의 자리에 주사위 값 입력 |
| 25 | 25_÷4 | 백의 자리에 주사위 값 입력 |
| 26 | 도착! | 최종 목적지 |

### 보드 레이아웃 패턴
- 1행: 0→1→2→3→4 (오른쪽으로)
- 2행: 9←8←7←6←5 (왼쪽으로)
- 3행: 10→11→12→13→14 (오른쪽으로)
- 4행: 19←18←17←16←15 (왼쪽으로)
- 5행: 20→21→22→23→24 (오른쪽으로)
- 6행: 25←26 (왼쪽으로 도착)

## 🗂️ 파일 구조

```
.
├── index.html                 # 메인 HTML 파일
├── css/
│   ├── style.css             # 스타일시트 (기본)
│   └── style-optimized.css   # 스타일시트 (최적화) ⭐
├── js/
│   ├── game.js               # 게임 로직 (기본)
│   └── game-optimized.js     # 게임 로직 (최적화) ⭐
├── README.md                 # 프로젝트 문서
└── OPTIMIZATION.md           # 최적화 문서 ⭐
```

### 최적화 버전 사용하기

최적화 버전은 기능은 동일하지만 코드 품질이 개선되었습니다:
- JavaScript: 17% 코드 감소, 모듈화 개선
- CSS: CSS 변수 사용, 중복 제거

**사용 방법**: `index.html`에서 주석을 변경하여 전환
```html
<!-- <script src="js/game.js"></script> -->
<script src="js/game-optimized.js"></script>
```

자세한 내용은 `OPTIMIZATION.md` 참조

## 🚀 기술 스택

- **HTML5**: 시맨틱 마크업
- **CSS3**: 
  - Flexbox & Grid 레이아웃
  - CSS 애니메이션 (주사위 굴리기)
  - 그라데이션 효과
  - 반응형 디자인
- **JavaScript (Vanilla)**: 
  - ES6+ 문법
  - DOM 조작
  - 게임 상태 관리
  - 이벤트 처리

## 💡 주요 알고리즘

### 나눗셈 계산 로직
```javascript
// 예: 3_÷4에 주사위 5가 나온 경우
dividend = 35  // 3 + 5(주사위)
divisor = 4
몫 = Math.floor(35 / 4) = 8
나머지 = 35 % 4 = 3
이동 거리 = 3칸
```

### 빈칸 유형
- `dividend0`: 피제수 백의 자리 (_4÷8)
- `dividend1`: 피제수 일의 자리 (3_÷4)
- `divisor0`: 제수 십의 자리 (8÷_4)
- `divisor1`: 제수 일의 자리 (6÷2_)

## 🎨 디자인 특징

- **플레이어 색상**: 빨강, 청록, 노랑, 민트 (최대 4명)
- **보드 디자인**: 그라데이션 배경과 입체감 있는 칸
- **애니메이션**: 부드러운 주사위 굴리기 효과
- **반응형**: 모바일, 태블릿, 데스크톱 모두 지원

## 📱 반응형 지원

- **Desktop**: 3단 레이아웃 (게임 정보 | 보드 | 플레이어 정보)
- **Tablet**: 1단 레이아웃 (수직 배치)
- **Mobile**: 4x5 그리드 보드, 버튼 세로 배치

## 🐛 최근 버그 수정 (2025-01-13)

### 🔥 중요 버그 수정: 사이트 멈춤 현상

**문제점**: 게임을 플레이하다 보면 사이트가 멈추는 현상 발생

**원인 분석**:
1. **이벤트 리스너 중복 등록** (Primary Issue)
   - `showRemainderInput()` 함수 호출 시마다 Enter 키 이벤트가 계속 추가됨
   - 게임 진행 시 이벤트 핸들러가 누적되어 한 번의 Enter 키에 여러 번 실행
   - 결과: 동시에 여러 제출 프로세스가 실행되어 프로그램 멈춤

2. **Oscillator 메모리 누적**
   - Web Audio API의 oscillator 객체들이 사용 후 적절히 정리되지 않음
   - 게임 진행 시 메모리에 oscillator 누적
   - 결과: 메모리 누수 및 성능 저하

3. **중복 제출 방지 부재**
   - 버튼이 비활성화되었는데도 Enter 키로 제출 가능
   - 답안 처리 중에 추가 제출이 발생할 수 있음

**해결 방법**:
```javascript
// ✅ FIX 1: 이벤트 리스너 중복 방지
// Before: onkeypress로 매번 새로 등록
answerInput.onkeypress = (e) => { submitAnswer(); }

// After: 분리된 핸들러 + removeEventListener
function handleAnswerKeyPress(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        if (!answerInput.disabled && !checkBtn.disabled) {
            submitAnswer();
        }
    }
}
answerInput.addEventListener('keypress', handleAnswerKeyPress);
// 정리 시: answerInput.removeEventListener('keypress', handleAnswerKeyPress);

// ✅ FIX 2: Oscillator 메모리 정리
oscillator.onended = () => {
    oscillator.disconnect();
    gainNode.disconnect();
};

// ✅ FIX 3: 중복 제출 방지
function submitAnswer() {
    if (answerInput.disabled || checkBtn.disabled) {
        return; // 이미 처리 중이면 무시
    }
    // ... 나머지 로직
}
```

**수정된 파일**: `js/game.js`

**테스트 결과**: 
- ✅ 이벤트 중복 등록 해결
- ✅ 메모리 누수 방지
- ✅ 안정적인 게임 진행 확인

## 🔮 향후 개발 계획

### 미구현 기능
- [ ] 게임 기록 저장 (로컬스토리지)
- [ ] 더 많은 특수 칸 (앞으로 점프, 한번 더 등)
- [ ] 난이도 선택 (쉬움/보통/어려움)
- [ ] 커스텀 보드 생성 기능
- [ ] 멀티플레이 온라인 모드
- [ ] 게임 통계 및 순위표
- [ ] 애니메이션 강화 (말 이동 애니메이션)
- [ ] 배경 음악 추가
- [ ] 더 다양한 효과음

### 권장 개선사항
1. **난이도 조절**: 보기 개수 조절 (쉬움 3개, 보통 6개, 어려움 9개)
2. **계산 과정 표시**: 몫 계산 과정도 단계별로 시각화
3. **힌트 시스템**: 틀렸을 때 힌트 제공 옵션
4. **통계 기록**: 정답률, 평균 시도 횟수 등 기록
5. **접근성 개선**: 키보드 네비게이션, 스크린 리더 지원
6. **성취 시스템**: 배지, 업적 시스템 추가
7. **튜토리얼**: 첫 플레이 시 게임 방법 안내

## 🎯 교육 목표

이 게임을 통해 학생들은:
- **나눗셈의 몫과 나머지 개념을 직접 계산하며 학습**
- 두 자리/세 자리 수의 나눗셈 연습
- 즉각적인 피드백을 통한 효과적인 학습
- 반복 학습을 통한 나머지 계산 능력 향상
- 게임을 통한 자연스러운 수학 학습
- 전략적 사고 능력 향상

### 핵심 학습 요소
1. **현재 위치에서 학습**: 자신의 말이 있는 칸의 나눗셈 문제 풀이
2. **주사위 숫자 대입**: 빈칸에 주사위 값을 넣어 나눗셈 완성
3. **단계별 시각화**: 
   - ① 주사위 결과 표시
   - ② 빈칸에 숫자 써넣기 과정
   - ③ 완성된 나눗셈 계산
   - ④ 나머지 선택
4. **나머지 직접 입력**: 학생이 직접 계산하여 답을 입력창에 입력
5. **답 확인 시스템**: 
   - 키보드로 숫자 입력
   - Enter 키 또는 "확인" 버튼으로 제출
   - 정답/오답 즉시 피드백
   - 틀린 경우 힌트 제공
6. **보기 기능 (선택)**: 
   - 💡 버튼으로 보기 보기/숨기기
   - 보기 클릭 시 입력창에 자동 채우기
   - 학습 단계에 맞춰 사용 가능
7. **재도전 기회**: 틀리면 다시 입력 가능, 정답 찾을 때까지 도전
7. **게임 요소**: 나머지만큼 이동하는 전략적 요소

### 🎲 게임 예시 (상세 과정)

**게임 시작**: 모든 플레이어는 1번 칸부터 시작

**상황**: 플레이어가 1번 칸에 있고, 칸의 문제는 "5_÷3"

#### 단계별 진행

1. **주사위 던지기**
   ```
   [주사위 던지기] 버튼 클릭
   → 🎲 주사위: 5
   ```

2. **과정 표시 (자동)**
   ```
   ① 주사위 결과: [5]
   ② 빈칸에 써넣기: 5[5]÷3
   ③ 나눗셈 계산: 55 ÷ 3 = 18 나머지 [?]
   ```

3. **나머지 입력**
   ```
   ④ 나머지를 입력하세요
   
   나머지 = [    1    ]
            ↑ 직접 입력
   
   [확인] 버튼 클릭
   
   (💡 보기 보기/숨기기 - 도움말)
   ```

4. **결과 확인**
   ```
   🎉 정답입니다!
   55 ÷ 3 = 18 나머지 1
   1칸 앞으로 이동합니다!
   
   → 2번 칸으로 이동
   ```

**또 다른 예시**: 나머지 0인 경우

**상황**: 3번 칸 "3_÷2"

1. 주사위: **4** → 34÷2
2. 과정 표시:
   ```
   ① 주사위 결과: [4]
   ② 빈칸에 써넣기: 3[4]÷2
   ③ 나눗셈 계산: 34 ÷ 2 = 17 나머지 [?]
   ```
3. 선택: **0** → 확인
4. 결과:
   ```
   🎉 정답입니다!
   나머지가 0입니다. 이동하지 않고 빈칸을 지웁니다.
   → 제자리, 다음 턴에 재도전
   ```

**오답 예시**: 틀렸을 때

1. 주사위: **5** → 55÷3 (정답: 나머지 1)
2. 선택: **2** (오답) → 확인
3. 결과:
   ```
   ❌ 틀렸습니다!
   다시 계산하고 선택해주세요!
   힌트: 55 ÷ 3를 계산해보세요
   
   → 다시 선택 가능 (틀린 답 [2]는 비활성화)
   ```

## 📝 라이선스

이 프로젝트는 교육 목적으로 자유롭게 사용할 수 있습니다.

## 🙏 크레딧

- 게임 디자인: 나눗셈 탐험 보드게임 컨셉
- 개발: AI Assistant
- 주사위 이모지: Unicode 표준

---

**즐거운 나눗셈 학습 되세요! 🎲📚**
